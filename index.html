<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EPHunter Form</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #ffffff;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
    }
    h1 { margin-bottom: 4px; }
    .subtitle {
      font-size: 10px;
      color: #666;
      margin-top: 0;
      margin-bottom: 10px;
    }
    .progress-bar {
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .progress {
      height: 100%;
      width: 0%;
      background-color: #4CAF50;
      transition: width 0.3s ease;
    }
    .step-indicator {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 20px;
      color: #4CAF50;
    }
    .step { display: none; animation: fadeIn 0.5s; }
    .step.active { display: block; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    label {
      display: block;
      margin-bottom: 5px;
      margin-top: 20px;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    select:invalid { color: #999; }
    button {
      margin-top: 30px;
      padding: 12px 20px;
      border: none;
      border-radius: 999px;
      background-color: #90EE90;
      color: white;
      cursor: pointer;
    }
    button:hover { background-color: #66cc66; }
    .btn-group {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    @media (max-width: 600px) {
      .btn-group { flex-direction: column; }
    }
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>EPHunter Form</h1>
  <div class="subtitle">Formulir pendaftaran Talent EPHunter</div>
  <div class="step-indicator">
    <span>Step 1</span><span>Step 2</span><span>Step 3</span><span>Step 4</span>
  </div>
  <div class="progress-bar"><div class="progress" id="progress"></div></div>

  <form id="talentForm">
    <!-- STEP 1 -->
    <div class="step active">
      <label>Nama <input name="nama" required></label>
      <label>Agama
        <select name="agama" required>
          <option disabled selected value="">Pilih Agama</option>
          <option>Islam</option><option>Katolik</option><option>Protestan</option><option>Budhha</option><option>Hindu</option><option>Konghucu</option>
        </select>
      </label>
      <label>Gender
        <select name="gender" required>
          <option disabled selected value="">Pilih Gender</option>
          <option>Laki-Laki</option><option>Perempuan</option>
        </select>
      </label>
      <label>Whatsapp <input name="whatsapp" type="tel" required></label>
      <label>Email <input name="email" type="email" required></label>
      <label>Tempat Lahir <input name="tempatLahir" required></label>
      <label>Tanggal Lahir <input name="tanggalLahir" type="date" required></label>
    </div>

    <!-- STEP 2 -->
    <div class="step">
      <label>Alamat Saat ini <textarea name="alamat" required></textarea></label>
      <label>Kota Domisili <input name="kota" required></label>
      <label>Provinsi
        <select name="provinsi" required>
          <option disabled selected value="">Pilih Provinsi</option>
                <option value="Aceh">Aceh</option>
                <option value="Sumatera Utara">Sumatera Utara</option>
                <option value="Sumatera Barat">Sumatera Barat</option>
                <option value="Riau">Riau</option>
                <option value="Kepulauan Riau">Kepulauan Riau</option>
                <option value="Jambi">Jambi</option>
                <option value="Sumatera Selatan">Sumatera Selatan</option>
                <option value="Kepulauan Bangka Belitung">Kepulauan Bangka Belitung</option>
                <option value="Bengkulu">Bengkulu</option>
                <option value="Lampung">Lampung</option>
                <option value="DKI Jakarta">DKI Jakarta</option>
                <option value="Jawa Barat">Jawa Barat</option>
                <option value="Banten">Banten</option>
                <option value="Jawa Tengah">Jawa Tengah</option>
                <option value="DI Yogyakarta">DI Yogyakarta</option>
                <option value="Jawa Timur">Jawa Timur</option>
                <option value="Bali">Bali</option>
                <option value="Nusa Tenggara Barat">Nusa Tenggara Barat</option>
                <option value="Nusa Tenggara Timur">Nusa Tenggara Timur</option>
                <option value="Kalimantan Barat">Kalimantan Barat</option>
                <option value="Kalimantan Tengah">Kalimantan Tengah</option>
                <option value="Kalimantan Selatan">Kalimantan Selatan</option>
                <option value="Kalimantan Timur">Kalimantan Timur</option>
                <option value="Kalimantan Utara">Kalimantan Utara</option>
                <option value="Sulawesi Utara">Sulawesi Utara</option>
                <option value="Gorontalo">Gorontalo</option>
                <option value="Sulawesi Tengah">Sulawesi Tengah</option>
                <option value="Sulawesi Barat">Sulawesi Barat</option>
                <option value="Sulawesi Selatan">Sulawesi Selatan</option>
                <option value="Sulawesi Tenggara">Sulawesi Tenggara</option>
                <option value="Maluku">Maluku</option>
                <option value="Maluku Utara">Maluku Utara</option>
                <option value="Papua">Papua</option>
                <option value="Papua Barat">Papua Barat</option>
                <option value="Papua Selatan">Papua Selatan</option>
                <option value="Papua Tengah">Papua Tengah</option>
                <option value="Papua Pegunungan">Papua Pegunungan</option>
                <option value="Papua Barat Daya">Papua Barat Daya</option>
        </select>
      </label>
      <label>Pendidikan
        <select name="pendidikan" required>
          <option disabled selected value="">Pilih Pendidikan</option>
          <option>SMA/SMK</option><option>Diploma</option><option>Sarjana</option><option>Magister</option><option>Doktor</option>
        </select>
      </label>
      <label>Nama Universitas <textarea name="Universitas" required></textarea></label>
    </div>

    <!-- STEP 3 -->
    <div class="step">
      <label>Posisi Terakhir <input name="posisiTerakhir" required></label>
      <label>Nama Perusahaan <input name="namaPerusahaan" required></label>
      <label>Level Posisi
        <select name="levelPosisi" required>
          <option disabled selected value="">Pilih Level</option>
          <option>Blue Collar</option><option>Junior Staff</option><option>Officer</option><option>Supervisor</option>
          <option>Ast Manager</option><option>Manager</option><option>Senior Manager</option><option>C-Level</option>
        </select>
      </label>
      <label>Industri Pekerjaan Terakhir
        <select name="industri" required>
          <option disabled selected value="">Pilih Industri</option>
            <option value="Manufaktur">Manufaktur</option>
            <option value="Otomotif">Otomotif</option>
            <option value="Elektronik">Elektronik</option>
            <option value="Tekstil dan garmen">Tekstil dan garmen</option>
            <option value="Makanan dan minuman">Makanan dan minuman</option>
            <option value="Kimia dan farmasi">Kimia dan farmasi</option>
            <option value="Pertambangan">Pertambangan</option>
            <option value="Minyak dan gas">Minyak dan gas</option>
            <option value="Batu bara">Batu bara</option>
            <option value="Logam dan mineral">Logam dan mineral</option>
            <option value="Energi terbarukan">Energi terbarukan</option>
            <option value="Perbankan">Perbankan</option>
            <option value="Asuransi">Asuransi</option>
            <option value="Teknologi finansial">Teknologi finansial (fintech)</option>
            <option value="E-commerce">E-commerce</option>
            <option value="Perangkat lunak dan teknologi digital">Perangkat lunak dan teknologi digital</option>
            <option value="Konstruksi">Konstruksi</option>
            <option value="Properti dan real estat">Properti dan real estat</option>
            <option value="Agribisnis">Agribisnis</option>
            <option value="Perkebunan">Perkebunan</option>
            <option value="Peternakan dan perikanan">Peternakan dan perikanan</option>
            <option value="Telekomunikasi">Telekomunikasi</option>
            <option value="Jaringan dan infrastruktur IT">Jaringan dan infrastruktur IT</option>
            <option value="Transportasi">Transportasi</option>
            <option value="Logistik dan pengiriman">Logistik dan pengiriman</option>
            <option value="Pariwisata">Pariwisata</option>
            <option value="Perhotelan dan hospitality">Perhotelan dan hospitality</option>
            <option value="Pendidikan berbasis teknologi">Pendidikan berbasis teknologi</option>
            <option value="Media dan hiburan">Media dan hiburan</option>
            <option value="Kreatif dan desain">Kreatif dan desain</option>
        </select>
      </label>
    </div>

    <!-- STEP 4 -->
    <div class="step">
      <label>Gaji Saat ini <input name="gajiSaatIni" required></label>
      <label>Harapan Gaji <input name="harapanGaji" required></label>
      <label>Posisi Dilamar
        <select name="posisiDilamar" required>
          <option disabled selected value="">Pilih Posisi</option>
          <option>Direktur Operasional-Coal Mining</option><option>Project Manager-Coal Mining</option><option>Freelance Recruiter - EPTeam</option>
          <option>Finance Officer - Mining Service</option><option>Admin Budgeting Control - Mining Service</option><option>Direktur Operasional-Hospitality</option>
        </select>
      </label>
      <label>Kesediaan Join
        <select name="kesediaanJoin" required>
          <option disabled selected value="">Pilih Kesediaan</option>
          <option>Secepatnya</option><option>1 Minggu</option><option>1 Bulan</option>
        </select>
      </label>
      <label>Upload CV <input type="file" name="cvFile" id="cvFile" accept=".pdf,.doc,.docx" required /></label>
    </div>

    <!-- Buttons -->
    <div class="btn-group">
      <button type="button" onclick="nextStep(-1)">Back</button>
      <button type="button" onclick="nextStep(1)">Next</button>
      <button type="submit" style="display:none">Kirim</button>
    </div>
  </form>

  <!-- Success Message -->
  <div id="successMessage" style="display:none; background:#d4edda; color:#155724; padding:15px; margin-top:20px; border:1px solid #c3e6cb; border-radius:8px; text-align:center; transition:opacity 0.5s ease; opacity:1;">
    Form berhasil dikirim. Terima kasih!
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;">
    <div style="background:#fff; padding:30px; border-radius:12px; max-width:400px; margin:120px auto; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
      <h3 style="margin-bottom: 20px; color: #333">Konfirmasi Pengiriman</h3>
      <p style="margin-bottom: 30px;">Apakah Anda yakin ingin mengirim formulir ini?</p>
      <button onclick="submitConfirmed(true)" style="padding:10px 20px; border:none; border-radius:8px; background-color:#4CAF50; color:white; margin-right:10px; cursor:pointer;">Ya</button>
      <button onclick="submitConfirmed(false)" style="padding:10px 20px; border:none; border-radius:8px; background-color:#ccc; color:#333; cursor:pointer;">Batal</button>
    </div>
  </div>
</div>

<script>
let currentStep = 0, steps, progress, nextBtn, backBtn, submitBtn, isSubmitting = false;

function formatNumberWithDots(value) {
  return value.replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}

function attachFormatter(inputName) {
  const input = document.querySelector(`input[name="${inputName}"]`);
  input.addEventListener('blur', () => {
    input.value = formatNumberWithDots(input.value);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  steps = document.querySelectorAll('.step');
  progress = document.getElementById('progress');
  nextBtn = document.querySelector('button[onclick="nextStep(1)"]');
  backBtn = document.querySelector('button[onclick="nextStep(-1)"]');
  submitBtn = document.querySelector('form button[type="submit"]');
  steps[0].classList.add('active');
  backBtn.style.display = 'none';
  updateProgress();
  attachFormatter('gajiSaatIni');
  attachFormatter('harapanGaji');
});

function updateProgress() {
  progress.style.width = ((currentStep + 1) / steps.length * 100) + '%';
}

function nextStep(direction) {
  if (!steps || steps.length === 0) return;
  steps[currentStep].classList.remove('active');
  currentStep += direction;
  currentStep = Math.max(0, Math.min(currentStep, steps.length - 1));
  steps[currentStep].classList.add('active');
  backBtn.style.display = currentStep === 0 ? 'none' : 'inline-block';
  nextBtn.style.display = currentStep === steps.length - 1 ? 'none' : 'inline-block';
  submitBtn.style.display = currentStep === steps.length - 1 ? 'inline-block' : 'none';
  updateProgress();
}

const form = document.getElementById('talentForm');
form.addEventListener('submit', (e) => {
  e.preventDefault();
  if (!isSubmitting) {
    document.getElementById("confirmModal").style.display = "block";
    return;
  }
  handleFormSubmission();
});

function submitConfirmed(confirm) {
  document.getElementById("confirmModal").style.display = "none";
  if (confirm) {
    isSubmitting = true;
    handleFormSubmission();
  }
}

function handleFormSubmission() {
  const fileInput = document.getElementById('cvFile');
  const file = fileInput?.files[0];
  if (!file) return alert("Silakan upload file CV terlebih dahulu.");

  const reader = new FileReader();
  reader.onloadend = function () {
    const base64 = reader.result.split(',')[1];
    const formData = Object.fromEntries(new FormData(form).entries());
    delete formData.cvFile;
    const payload = { ...formData, filename: file.name, mimeType: file.type, fileData: base64 };

    google.script.run.withSuccessHandler(() => {
      showSuccessMessage();
      form.reset();
      currentStep = 0;
      steps.forEach((step, idx) => step.classList.toggle('active', idx === currentStep));
      backBtn.style.display = 'none';
      nextBtn.style.display = 'inline-block';
      submitBtn.style.display = 'none';
      updateProgress();
      isSubmitting = false;
    }).uploadFile(payload);
  };
  reader.readAsDataURL(file);
}

function showSuccessMessage() {
  const msg = document.getElementById('successMessage');
  msg.style.display = 'block';
  msg.style.opacity = '1';
  setTimeout(() => {
    msg.style.opacity = '0';
    setTimeout(() => { msg.style.display = 'none'; }, 500);
  }, 4000);
}
</script>
</body>
</html>
